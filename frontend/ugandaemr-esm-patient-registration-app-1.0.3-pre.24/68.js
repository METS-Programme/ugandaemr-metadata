(globalThis.webpackChunk_ugandaemr_esm_patient_registration_app=globalThis.webpackChunk_ugandaemr_esm_patient_registration_app||[]).push([[68],{225:(e,t,n)=>{"use strict";n.d(t,{X8:()=>s,bT:()=>u,bs:()=>o});var i=n(2870);function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function a(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var o=[{id:"demographics",name:"Basic Info",fields:["name","gender","dob","id"]},{id:"contact",name:"Contact Details",fields:["address","phone"]},{id:"death",name:"Death Info",fields:[]},{id:"relationships",name:"Relationships",fields:[]}],s=["name","gender","dob","address","id","phone & email"],u={sections:{_type:i.Type.Array,_default:["demographics","contact","relationships"],_description:"An array of strings which are the keys from 'sectionDefinitions' or any of the following built-in sections: '".concat(o.map((function(e){return e.id})).join("', '"),"'."),_elements:{_type:i.Type.String}},sectionDefinitions:{_type:i.Type.Array,_elements:{id:{_type:i.Type.String,_description:"How this section will be referred to in the `sections` configuration. To override a built-in section, use that section's id. The built in section ids are '".concat(o.map((function(e){return e.id})).join("', '"),"'.")},name:{_type:i.Type.String,_description:"The title to display at the top of the section."},fields:{_type:i.Type.Array,_default:[],_description:"The parts to include in the section. Can be any of the following built-in fields: ".concat(s.join(", "),". Can also be an id from an object in the `fieldDefinitions` array, which you can use to define custom fields."),_elements:{_type:i.Type.String}}},_default:[]},fieldDefinitions:{_type:i.Type.Array,_elements:{id:{_type:i.Type.String,_description:"How this field will be referred to in the `fields` element of the `sectionDefinitions` configuration."},type:{_type:i.Type.String,_description:"How this field's data will be storedâ€”a person attribute or an obs."},uuid:{_type:i.Type.UUID,_description:"Person attribute type UUID that this field's data should be saved to."},showHeading:{_type:i.Type.Boolean,_description:"Whether to show a heading above the person attribute field.",_default:!1},label:{_type:i.Type.String,_default:null,_description:"The label of the input. By default, uses the metadata `display` attribute."},placeholder:{_type:i.Type.String,_default:"",_description:"Placeholder that will appear in the input."},validation:{required:{_type:i.Type.Boolean,_default:!1},matches:{_type:i.Type.String,_default:null,_description:"Optional RegEx for testing the validity of the input."}},answerConceptSetUuid:{_type:i.Type.ConceptUuid,_default:null,_description:"For coded questions only. A concept which has the possible responses either as answers or as set members."},customConceptAnswers:{_type:i.Type.Array,_elements:{uuid:{_type:i.Type.UUID,_description:"Answer concept UUID"},label:{_type:i.Type.String,_default:null,_description:"The custom label for the answer concept."}},_default:[],_description:"For coded questions only. Provide ability to add custom concept answers."}},_default:[{id:"phone",type:"person attribute",uuid:"14d4f066-15f5-102d-96e4-000c29c2a5d7",showHeading:!1,validation:{matches:""}}],_description:"Definitions for custom fields that can be used in sectionDefinitions. Can also be used to override built-in fields."},fieldConfigurations:{name:{displayMiddleName:{_type:i.Type.Boolean,_default:!0},allowUnidentifiedPatients:{_type:i.Type.Boolean,_default:!0,_description:"Whether to allow registering unidentified patients."},defaultUnknownGivenName:{_type:i.Type.String,_default:"UNKNOWN",_description:"The given/first name to record for unidentified patients."},defaultUnknownFamilyName:{_type:i.Type.String,_default:"UNKNOWN",_description:"The family/last name to record for unidentified patients."},displayCapturePhoto:{_type:i.Type.Boolean,_default:!0,_description:"Whether to display capture patient photo slot on name field"},displayReverseFieldOrder:{_type:i.Type.Boolean,_default:!1,_description:"Whether to display the name fields in the order 'Family name' -> 'Middle name' -> 'First name'"}},gender:{_type:i.Type.Array,_elements:{value:{_type:i.Type.String,_description:"The value for sex option"},label:{_type:i.Type.String,_default:null,_description:"The label displayed for sex option."},id:{_type:i.Type.String,_default:null,_description:"The id for sex option."}},_default:[{id:"male",value:"Male",label:"Male"},{id:"female",value:"Female",label:"Female"}],_description:"Provide ability to configure sex options."},address:{useAddressHierarchy:{enabled:{_type:i.Type.Boolean,_description:"Whether to use the Address hierarchy in the registration form or not",_default:!0},useQuickSearch:{_type:i.Type.Boolean,_description:"Whether to use the quick searching through the address saved in the database pre-fill the form.",_default:!0},searchAddressByLevel:{_type:i.Type.Boolean,_description:"Whether to fill the addresses by levels, i.e. County => subCounty, the current field is dependent on it's previous field.",_default:!1},useAddressHierarchyLabel:{_type:i.Type.Object,_description:"Whether to use custom labels for address hierarchy",_default:{}}}},dateOfBirth:{allowEstimatedDateOfBirth:{_type:i.Type.Boolean,_description:"Whether to allow estimated date of birth for a patient during registration",_default:!0},useEstimatedDateOfBirth:{enabled:{_type:i.Type.Boolean,_description:"Whether to use a fixed day and month for estimated date of birth",_default:!1},dayOfMonth:{_type:i.Type.Number,_description:"The custom day of the month use on the estimated date of birth",_default:0},month:{_type:i.Type.Number,_description:"The custom month to use on the estimated date of birth i.e 0 = Jan & 11 = Dec",_default:0}}}},links:{submitButton:{_type:i.Type.String,_default:"${openmrsSpaBase}/patient/${patientUuid}/chart",_validators:[i.validators.isUrlWithTemplateParameters(["patientUuid"])]}},concepts:{patientPhotoUuid:{_type:i.Type.ConceptUuid,_default:"736e8771-e501-4615-bfa7-570c03f4bef5"}},defaultPatientIdentifierTypes:{_type:i.Type.Array,_elements:{_type:i.Type.PatientIdentifierTypeUuid},_default:[]},registrationObs:{encounterTypeUuid:{_type:i.Type.UUID,_default:null,_description:"Obs created during registration will be associated with an encounter of this type. This must be set in order to use fields of type `obs`."},encounterProviderRoleUuid:{_type:i.Type.UUID,_default:"a0b03050-c99b-11e0-9572-0800200c9a66",_description:"The provider role to use for the registration encounter. Default is 'Unkown'."},registrationFormUuid:{_type:i.Type.UUID,_default:null,_description:"The form UUID to associate with the registration encounter. By default no form will be associated."}},_validators:[(0,i.validator)((function(e){return!e.fieldDefinitions.some((function(e){return"obs"==e.type}))||null!=e.registrationObs.encounterTypeUuid}),"If fieldDefinitions contains any fields of type 'obs', `registrationObs.encounterTypeUuid` must be specified."),(0,i.validator)((function(e){return e.sections.every((function(t){return a(o).concat(a(e.sectionDefinitions)).map((function(e){return e.id})).includes(t)}))}),(function(e){var t=a(o).concat(a(e.sectionDefinitions)).map((function(e){return e.id})),n=e.sections.find((function(e){return!t.includes(e)}));return"'".concat(n,"' is not a valid section ID. Valid section IDs include the built-in sections ").concat(l(o))+(e.sectionDefinitions.length?"; and the defined sections ".concat(l(e.sectionDefinitions),"."):".")})),(0,i.validator)((function(e){return e.sectionDefinitions.every((function(t){return t.fields.every((function(t){return a(s).concat(a(e.fieldDefinitions.map((function(e){return e.id})))).includes(t)}))}))}),(function(e){var t=a(s).concat(a(e.fieldDefinitions.map((function(e){return e.id})))),n=e.sectionDefinitions.find((function(e){return e.fields.some((function(e){return!t.includes(e)}))})),i=n.fields.find((function(e){return!t.includes(e)}));return"The section definition '".concat(n.id,"' contains an invalid field '").concat(i,"'. 'fields' can only contain the built-in fields '").concat(s.join("', '"),"'")+(e.fieldDefinitions.length?"; or the defined fields ".concat(l(e.fieldDefinitions),"."):".")}))]};function l(e){return"'".concat(e.map((function(e){return e.id})).join("', '"),"'")}},8179:(e,t,n)=>{"use strict";n.d(t,{Kt:()=>l,QT:()=>c,UO:()=>s,e1:()=>u});var i,r,a,o=n(2870),s="custom:(display,uuid,personA:(age,display,birthdate,uuid),personB:(age,display,birthdate,uuid),relationshipType:(uuid,display,description,aIsToB,bIsToA))",u="@ugandaemr/esm-patient-registration-app",l="patient-registration",c=(i={},a="network-first",(r=o.omrsOfflineCachingStrategyHttpHeaderName)in i?Object.defineProperty(i,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):i[r]=a,i)},7068:(e,t,n)=>{"use strict";n.r(t),n.d(t,{addPatientLink:()=>_,cancelPatientEditModal:()=>T,confirmRegistryModal:()=>S,deleteIdentifierConfirmationModal:()=>U,editPatient:()=>w,editPatientDetailsButton:()=>D,emptyRegistryModal:()=>A,importTranslation:()=>m,multiplePatientModal:()=>C,patientPhoto:()=>P,postToRegistryModal:()=>O,root:()=>g,startupApp:()=>v});var i=n(2870),r=n(225),a=n(8179),o=n(6279),s=n(3076);function u(e,t,n,i,r,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(i,r)}function l(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var a=e.apply(t,n);function o(e){u(a,i,r,o,s,"next",e)}function s(e){u(a,i,r,o,s,"throw",e)}o(void 0)}))}}var c=function(e,t){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};function d(e){return["/ws/fhir2/R4/Patient/".concat(e),"/ws/rest/v1/relationship?v=".concat(a.UO,"&person=").concat(e),"/ws/rest/v1/person/".concat(e,"/attribute"),"/ws/rest/v1/patient/".concat(e,"/identifier?v=custom:(uuid,identifier,identifierType:(uuid,required,name),preferred)")].map((function(e){return window.origin+(0,i.makeUrl)(e)}))}function p(){return f.apply(this,arguments)}function f(){return(f=l((function(){return c(this,(function(e){switch(e.label){case 0:return[4,Promise.all([(0,o.X1)(),(0,o.Te)(),(0,o.mt)(),(0,o.St)()])];case 1:return e.sent(),[2]}}))}))).apply(this,arguments)}function h(e,t){return y.apply(this,arguments)}function y(){return y=l((function(e,t){return c(this,(function(n){switch(n.label){case 0:return[4,s.y.savePatientFormOnline(e._patientRegistrationData.isNewPatient,e._patientRegistrationData.formValues,e._patientRegistrationData.patientUuidMap,e._patientRegistrationData.initialAddressFieldValues,e._patientRegistrationData.capturePhotoProps,e._patientRegistrationData.currentLocation,e._patientRegistrationData.initialIdentifierValues,e._patientRegistrationData.currentUser,e._patientRegistrationData.config,e._patientRegistrationData.savePatientTransactionManager,t.abort)];case 1:return n.sent(),[2]}}))})),y.apply(this,arguments)}var m=n(3979),b={featureName:"Patient Registration",moduleName:a.e1};function v(){(0,i.defineConfigSchema)(a.e1,r.bT),(0,i.registerBreadcrumbs)([{path:"".concat(window.spaBase,"/").concat(a.Kt),title:"Patient Registration",parent:"".concat(window.spaBase,"/home")},{path:"".concat(window.spaBase,"/patient/:patientUuid/edit"),title:"Edit patient details",parent:"".concat(window.spaBase,"/patient/:patientUuid/chart")}]),(0,i.setupOfflineSync)(a.Kt,[],h,{onBeginEditSyncItem:function(e){(0,i.navigate)({to:"${openmrsSpaBase}/patient/".concat(e.content.fhirPatient.id,"/edit")})}}),(0,i.subscribePrecacheStaticDependencies)(p),(0,i.setupDynamicOfflineDataHandler)({id:"esm-patient-registration-app:patient",type:"patient",displayName:"Patient registration",isSynced:function(e){return l((function(){var t,n;return c(this,(function(i){switch(i.label){case 0:return t=d(e),[4,caches.open("omrs-spa-cache-v1")];case 1:return[4,i.sent().keys()];case 2:return n=i.sent().map((function(e){return e.url})),[2,t.every((function(e){return n.includes(e)}))]}}))}))()},sync:function(e){return l((function(){var t;return c(this,(function(n){switch(n.label){case 0:return t=d(e),[4,Promise.allSettled(t.map((r=l((function(e){return c(this,(function(t){switch(t.label){case 0:return[4,(0,i.messageOmrsServiceWorker)({type:"registerDynamicRoute",url:e})];case 1:return t.sent(),[4,fetch(e)];case 2:return t.sent(),[2]}}))})),function(e){return r.apply(this,arguments)})))];case 1:return n.sent(),[2]}var r}))}))()}})}var g=(0,i.getAsyncLifecycle)((function(){return Promise.all([n.e(577),n.e(37),n.e(626),n.e(924),n.e(115)]).then(n.bind(n,2379))}),b),w=(0,i.getAsyncLifecycle)((function(){return Promise.all([n.e(577),n.e(37),n.e(626),n.e(924),n.e(115)]).then(n.bind(n,2379))}),{featureName:"edit-patient-details-form",moduleName:a.e1}),_=(0,i.getAsyncLifecycle)((function(){return Promise.all([n.e(577),n.e(37),n.e(742)]).then(n.bind(n,8742))}),b),T=(0,i.getAsyncLifecycle)((function(){return Promise.all([n.e(577),n.e(924),n.e(735)]).then(n.bind(n,5735))}),b),P=(0,i.getAsyncLifecycle)((function(){return Promise.all([n.e(985),n.e(975)]).then(n.bind(n,9975))}),b),D=(0,i.getAsyncLifecycle)((function(){return Promise.all([n.e(924),n.e(635)]).then(n.bind(n,2635))}),{featureName:"edit-patient-details",moduleName:a.e1}),U=(0,i.getAsyncLifecycle)((function(){return Promise.all([n.e(577),n.e(924),n.e(537)]).then(n.bind(n,3537))}),b),S=(0,i.getAsyncLifecycle)((function(){return Promise.all([n.e(577),n.e(924),n.e(59)]).then(n.bind(n,7059))}),b),A=(0,i.getAsyncLifecycle)((function(){return Promise.all([n.e(577),n.e(924),n.e(330)]).then(n.bind(n,1330))}),b),O=(0,i.getAsyncLifecycle)((function(){return Promise.all([n.e(577),n.e(924),n.e(217)]).then(n.bind(n,7217))}),b),C=(0,i.getAsyncLifecycle)((function(){return Promise.all([n.e(577),n.e(924),n.e(379)]).then(n.bind(n,1379))}),b)},6279:(e,t,n)=>{"use strict";n.d(t,{Cg:()=>_,St:()=>O,Te:()=>D,X1:()=>T,mt:()=>S});var r=n(268),a=n.n(r),o=n(8627),s=n(2777),u=n(8407),l=n(2870),c=n(8179);function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function p(e){if(Array.isArray(e))return e}function f(e,t,n,i,r,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(i,r)}function h(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var a=e.apply(t,n);function o(e){f(a,i,r,o,s,"next",e)}function s(e){f(a,i,r,o,s,"throw",e)}o(void 0)}))}}function y(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function m(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function b(e,t){return p(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(i=n.next()).done)&&(a.push(i.value),!t||a.length!==t);o=!0);}catch(e){s=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw r}}return a}}(e,t)||g(e,t)||m()}function v(e){return p(e)||y(e)||g(e,i)||m()}function g(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}var w=function(e,t){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},_=a().createContext(null);function T(){return P.apply(this,arguments)}function P(){return(P=h((function(){return w(this,(function(e){switch(e.label){case 0:return[4,B("/ws/rest/v1/session")];case 1:return[2,e.sent().data]}}))}))).apply(this,arguments)}function D(){return U.apply(this,arguments)}function U(){return(U=h((function(){return w(this,(function(e){switch(e.label){case 0:return[4,B("/ws/rest/v1/addresstemplate")];case 1:return[2,e.sent().data]}}))}))).apply(this,arguments)}function S(){return A.apply(this,arguments)}function A(){return(A=h((function(){return w(this,(function(e){switch(e.label){case 0:return[4,B("/ws/rest/v1/relationshiptype?v=default")];case 1:return[2,e.sent().data]}}))}))).apply(this,arguments)}function O(){return C.apply(this,arguments)}function C(){return C=h((function(){var e,t,n,i,r,a;return w(this,(function(s){switch(s.label){case 0:return[4,N()];case 1:return e=s.sent(),t=e.filter(Boolean),[4,Promise.all([I()].concat((u=t.map((function(e){return function(e){return k.apply(this,arguments)}(e.uuid)})),function(e){if(Array.isArray(e))return d(e)}(u)||y(u)||g(u)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())))];case 2:for(n=v.apply(void 0,[s.sent()]),i=n[0],r=n.slice(1),a=0;a<(null==t?void 0:t.length);a++)t[a].identifierSources=r[a].data.results.map((function(e){var t=(0,o.Z)(i.data.results,{source:{uuid:e.uuid}});return e.autoGenerationOption=t,e}));return[2,t]}var u}))})),C.apply(this,arguments)}function N(){return j.apply(this,arguments)}function j(){return(j=h((function(){var e,t,n,i,r,a,o,u,l;return w(this,(function(c){switch(c.label){case 0:return[4,Promise.all([B("/ws/rest/v1/patientidentifiertype?v=custom:(display,uuid,name,format,required,uniquenessBehavior)"),B("/ws/rest/v1/metadatamapping/termmapping?v=full&code=emr.primaryIdentifierType")])];case 1:return e=b.apply(void 0,[c.sent(),2]),t=e[0],n=e[1],t.ok?(u=null==t||null===(i=t.data)||void 0===i?void 0:i.results,null==n||null===(r=n.data)||void 0===r||null===(a=r.results)||void 0===a||null===(o=a[0])||void 0===o||o.metadataUuid,l=[],u.forEach((function(e){var t;l.push((!1,{name:(t=e).display,fieldName:(0,s.Z)(t.name),required:t.required,uuid:t.uuid,format:t.format,isPrimary:false,uniquenessBehavior:t.uniquenessBehavior}))})),[2,l]):[2,[]]}}))}))).apply(this,arguments)}function k(){return(k=h((function(e){return w(this,(function(t){switch(t.label){case 0:return[4,B("/ws/rest/v1/idgen/identifiersource?v=default&identifierType=".concat(e))];case 1:return[2,t.sent()]}}))}))).apply(this,arguments)}function I(e){return E.apply(this,arguments)}function E(){return(E=h((function(e){return w(this,(function(e){switch(e.label){case 0:return[4,B("/ws/rest/v1/idgen/autogenerationoption?v=full")];case 1:return[2,e.sent()]}}))}))).apply(this,arguments)}function B(e){return F.apply(this,arguments)}function F(){return(F=h((function(e){var t;return w(this,(function(n){switch(n.label){case 0:return t=new AbortController,[4,(0,l.messageOmrsServiceWorker)({type:"registerDynamicRoute",pattern:(0,u.Z)(e)})];case 1:return n.sent(),[4,(0,l.openmrsFetch)(e,{headers:c.QT,signal:null==t?void 0:t.signal})];case 2:return[2,n.sent()]}}))}))).apply(this,arguments)}},3076:(e,t,n)=>{"use strict";n.d(t,{I:()=>m,y:()=>y});var i=n(2870),r=n(8179),a=n(7117);function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function s(e,t,n,i,r,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(i,r)}function u(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var a=e.apply(t,n);function o(e){s(a,i,r,o,u,"next",e)}function u(e){s(a,i,r,o,u,"throw",e)}o(void 0)}))}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){c(e,t,n[t])}))}return e}function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(i=n.next()).done)&&(a.push(i.value),!t||a.length!==t);o=!0);}catch(e){s=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw r}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var f,h=function(e,t){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},y=function(){function e(){l(this,e)}return e.saveRelationships=function(e,t){return u((function(){return h(this,(function(n){return[2,Promise.all(e.filter((function(e){return e.relationshipType})).filter((function(e){return!!e.action})).map((function(e){var n=e.relatedPersonUuid,i=e.relationshipType,r=e.uuid,o=e.action,s=p(i.split("/"),2),u=s[0],l=s[1],c=t.data.uuid,d="aIsToB"===l,f={personA:d?n:c,personB:d?c:n,relationshipType:u};switch(o){case"ADD":return(0,a.bL)(f);case"UPDATE":return(0,a.r6)(r,f);case"DELETE":return(0,a.kE)(r)}})))]}))}))()},e.saveObservations=function(e,t,n,i,r){return u((function(){var o;return h(this,(function(s){if(e&&Object.keys(e).length>0){if(r.registrationObs.encounterTypeUuid)return o={encounterDatetime:new Date,patient:t.data.uuid,encounterType:r.registrationObs.encounterTypeUuid,location:n,encounterProviders:[{provider:i.currentProvider.uuid,encounterRole:r.registrationObs.encounterProviderRoleUuid}],form:r.registrationObs.registrationFormUuid,obs:Object.keys(e).map((function(t){return{concept:t,value:e[t]}}))},[2,(0,a.M1)(o)];console.error("The registration form has been configured to have obs fields, but no registration encounter type has been configured. Obs field values will not be saved.")}return[2]}))}))()},e.savePatientIdentifiers=function(e,t,n,i,r){return u((function(){var o;return h(this,(function(s){var l;return o=Object.values(n).filter((function(e){var t=e.identifierValue,n=e.autoGeneration,i=e.selectedSource;return t||n&&i})).map((l=u((function(n){var i,o,s,u,l,c,d,p,f,y;return h(this,(function(h){switch(h.label){case 0:return i=n.identifierTypeUuid,o=n.identifierValue,s=n.identifierUuid,u=n.selectedSource,l=n.preferred,c=n.autoGeneration,d=n.initialValue,c?[3,1]:(f=o,[3,4]);case 1:return[4,(0,a.fX)(u.uuid)];case 2:return[4,h.sent().data.identifier];case 3:f=h.sent(),h.label=4;case 4:return y={uuid:s,identifier:p=f,identifierType:i,location:r,preferred:l},e?[3,8]:d?[3,6]:[4,(0,a.eb)(t,y)];case 5:return h.sent(),[3,8];case 6:return d===p?[3,8]:[4,(0,a.nI)(t,s,y.identifier)];case 7:h.sent(),h.label=8;case 8:return[2,y]}}))})),function(e){return l.apply(this,arguments)})),t&&Object.keys(i).filter((function(e){return!n[e]})).forEach(function(){var e=u((function(e){return h(this,(function(n){switch(n.label){case 0:return[4,(0,a.ZB)(t,i[e].identifierUuid)];case 1:return n.sent(),[2]}}))}));return function(t){return e.apply(this,arguments)}}()),[2,Promise.all(o)]}))}))()},e.getDeletedNames=function(e,t){return(null==t?void 0:t.additionalNameUuid)?[{nameUuid:t.additionalNameUuid,personUuid:e}]:[]},e.getPatientToCreate=function(t,n,i,r,a){var o,s,u;return s=n.birthdate,o=(null!=(u=Date)&&"undefined"!=typeof Symbol&&u[Symbol.hasInstance]?u[Symbol.hasInstance](s):s instanceof u)?[n.birthdate.getFullYear(),n.birthdate.getMonth()+1,n.birthdate.getDate()].join("-"):n.birthdate,{uuid:n.patientUuid,person:d({uuid:n.patientUuid,names:e.getNames(n,i),gender:n.gender.charAt(0),birthdate:o,birthdateEstimated:n.birthdateEstimated,attributes:e.getPatientAttributes(t,n,i),addresses:[n.address]},e.getPatientDeathInfo(n)),identifiers:a}},e.getNames=function(e,t){var n=[{uuid:t.preferredNameUuid,preferred:!0,givenName:e.givenName,middleName:e.middleName,familyName:e.familyName}];return e.addNameInLocalLanguage&&n.push({uuid:t.additionalNameUuid,preferred:!1,givenName:e.additionalGivenName,middleName:e.additionalMiddleName,familyName:e.additionalFamilyName}),n},e.getPatientAttributes=function(e,t,n){var r,a=[];return t.attributes&&(Object.entries(t.attributes).filter((function(e){return!!p(e,2)[1]})).forEach((function(e){var t=p(e,2),n=t[0],i=t[1];a.push({attributeType:n,value:i})})),!e&&t.patientUuid&&Object.entries(t.attributes).filter((function(e){return!p(e,2)[1]})).forEach((r=u((function(e){var r,a,o;return h(this,(function(s){switch(s.label){case 0:return r=p(e,1),a=r[0],o=n["attribute.".concat(a)],[4,(0,i.openmrsFetch)("/ws/rest/v1/person/".concat(t.patientUuid,"/attribute/").concat(o),{method:"DELETE"}).catch((function(e){console.error(e)}))];case 1:return s.sent(),[2]}}))})),function(e){return r.apply(this,arguments)}))),a},e.getPatientDeathInfo=function(e){var t=e.isDead,n=e.deathDate,i=e.deathCause;return{dead:t,deathDate:t?n:void 0,causeOfDeath:t?i:void 0}},e.mapPatientToFhirPatient=function(e){var t,n,i,r,a,o;return{id:e.uuid,gender:{M:"male",F:"female",O:"other",U:"unknown"}[null===(t=e.person)||void 0===t?void 0:t.gender],birthDate:null===(n=e.person)||void 0===n?void 0:n.birthdate,deceasedBoolean:e.person.dead,deceasedDateTime:e.person.deathDate,name:null===(i=e.person)||void 0===i||null===(r=i.names)||void 0===r?void 0:r.map((function(e){return{given:[e.givenName,e.middleName].filter(Boolean),family:e.familyName}})),address:null===(a=e.person)||void 0===a?void 0:a.addresses.map((function(e){return{city:e.cityVillage,country:e.country,postalCode:e.postalCode,state:e.stateProvince,use:"home"}})),telecom:null===(o=e.person.attributes)||void 0===o?void 0:o.filter((function(e){return"Telephone Number"===e.attributeType}))}},e}();y.savePatientFormOffline=(f=u((function(e,t,n,a,o,s,u,l,c){var d;return h(this,(function(p){switch(p.label){case 0:return d={fhirPatient:y.mapPatientToFhirPatient(y.getPatientToCreate(e,t,n,a,[])),_patientRegistrationData:{isNewPatient:e,formValues:t,patientUuidMap:n,initialAddressFieldValues:a,capturePhotoProps:o,currentLocation:s,initialIdentifierValues:u,currentUser:l,config:c,savePatientTransactionManager:new m}},[4,(0,i.queueSynchronizationItem)(r.Kt,d,{id:t.patientUuid,displayName:"Patient registration",patientUuid:d.fhirPatient.id,dependencies:[]})];case 1:return p.sent(),[2,null]}}))})),function(e,t,n,i,r,a,o,s,u){return f.apply(this,arguments)}),y.savePatientFormOnline=function(){var e=u((function(e,t,n,i,r,o,s,l,c,d,p){var f,m,b;return h(this,(function(p){switch(p.label){case 0:return[4,y.savePatientIdentifiers(e,t.patientUuid,t.identifiers,s,o)];case 1:return f=p.sent(),m=y.getPatientToCreate(e,t,n,i,f),y.getDeletedNames(t.patientUuid,n).forEach(function(){var e=u((function(e){return h(this,(function(t){switch(t.label){case 0:return[4,(0,a.uO)(e.nameUuid,e.personUuid)];case 1:return t.sent(),[2]}}))}));return function(t){return e.apply(this,arguments)}}()),[4,(0,a.co)(m,e&&!d.patientSaved?void 0:t.patientUuid)];case 2:return(b=p.sent()).ok?(d.patientSaved=!0,[4,y.saveRelationships(t.relationships,b)]):[3,6];case 3:return p.sent(),[4,y.saveObservations(t.obs,b,o,l,c)];case 4:return p.sent(),c.concepts.patientPhotoUuid&&(null==r?void 0:r.imageData)?[4,(0,a.oV)(b.data.uuid,r.imageData,"/ws/rest/v1/obs",r.dateTime||(new Date).toISOString(),c.concepts.patientPhotoUuid)]:[3,6];case 5:p.sent(),p.label=6;case 6:return[2,b.data.uuid]}}))}));return function(t,n,i,r,a,o,s,u,l,c,d){return e.apply(this,arguments)}}();var m=function e(){l(this,e),this.patientSaved=!1}},7117:(e,t,n)=>{"use strict";n.d(t,{M1:()=>l,M8:()=>v,Uu:()=>b,ZB:()=>D,bL:()=>p,co:()=>u,eb:()=>w,fX:()=>c,kE:()=>h,nI:()=>T,oV:()=>y,r6:()=>f,uO:()=>d});var i=n(3255),r=n(2870);function a(e,t,n,i,r,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(i,r)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){a(o,i,r,s,u,"next",e)}function u(e){a(o,i,r,s,u,"throw",e)}s(void 0)}))}}var s=function(e,t){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};function u(e,t){var n=new AbortController;return(0,r.openmrsFetch)("/ws/rest/v1/patient/".concat(t||""),{headers:{"Content-Type":"application/json"},method:"POST",body:e,signal:n.signal})}function l(e){var t=new AbortController;return(0,r.openmrsFetch)("/ws/rest/v1/encounter",{headers:{"Content-Type":"application/json"},method:"POST",body:e,signal:t.signal})}function c(e){var t=new AbortController;return(0,r.openmrsFetch)("/ws/rest/v1/idgen/identifiersource/".concat(e,"/identifier"),{headers:{"Content-Type":"application/json"},method:"POST",body:{},signal:t.signal})}function d(e,t){var n=new AbortController;return(0,r.openmrsFetch)("/ws/rest/v1/person/".concat(t,"/name/").concat(e),{method:"DELETE",signal:n.signal})}function p(e){var t=new AbortController;return(0,r.openmrsFetch)("/ws/rest/v1/relationship",{headers:{"Content-Type":"application/json"},method:"POST",body:e,signal:t.signal})}function f(e,t){var n=new AbortController;return(0,r.openmrsFetch)("/ws/rest/v1/relationship/".concat(e),{headers:{"Content-Type":"application/json"},method:"POST",body:{relationshipType:t.relationshipType},signal:n.signal})}function h(e){var t=new AbortController;return(0,r.openmrsFetch)("/ws/rest/v1/relationship/".concat(e),{headers:{"Content-Type":"application/json"},method:"DELETE",signal:t.signal})}function y(e,t,n,i,r){return m.apply(this,arguments)}function m(){return(m=o((function(e,t,n,i,a){var o,u;return s(this,(function(s){return o=new AbortController,(u=new FormData).append("patient",e),u.append("file",function(e){for(var t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],i=new Uint8Array(t.length),r=0;r<t.length;r++)i[r]=t.charCodeAt(r);var a=new Blob([i],{type:n});return new File([a],"patient-photo.png")}(t)),u.append("json",JSON.stringify({person:e,concept:a,groupMembers:[],obsDatetime:i})),[2,(0,r.openmrsFetch)(n,{method:"POST",signal:o.signal,body:u})]}))}))).apply(this,arguments)}function b(e){var t,n,a,o=(0,r.useConfig)().concepts.patientPhotoUuid,s="/ws/rest/v1/obs?patient=".concat(e,"&concept=").concat(o,"&v=full"),u=(0,i.ZP)(e?s:null,r.openmrsFetch),l=u.data,c=u.error,d=u.isLoading,p=null==l||null===(t=l.data)||void 0===t?void 0:t.results[0];return{data:p?{dateTime:null==p?void 0:p.obsDatetime,imageSrc:null==p||null===(n=p.value)||void 0===n||null===(a=n.links)||void 0===a?void 0:a.uri}:null,isError:c,isLoading:d}}function v(e){return g.apply(this,arguments)}function g(){return(g=o((function(e){var t;return s(this,(function(n){return t=new AbortController,[2,(0,r.openmrsFetch)("/ws/rest/v1/person?q=".concat(e),{signal:t.signal})]}))}))).apply(this,arguments)}function w(e,t){return _.apply(this,arguments)}function _(){return(_=o((function(e,t){var n;return s(this,(function(i){return n=new AbortController,[2,(0,r.openmrsFetch)("/ws/rest/v1/patient/".concat(e,"/identifier/"),{method:"POST",headers:{"Content-Type":"application/json"},signal:n.signal,body:t})]}))}))).apply(this,arguments)}function T(e,t,n){return P.apply(this,arguments)}function P(){return(P=o((function(e,t,n){var i;return s(this,(function(a){return i=new AbortController,[2,(0,r.openmrsFetch)("/ws/rest/v1/patient/".concat(e,"/identifier/").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},signal:i.signal,body:{identifier:n}})]}))}))).apply(this,arguments)}function D(e,t){return U.apply(this,arguments)}function U(){return(U=o((function(e,t){var n;return s(this,(function(i){return n=new AbortController,[2,(0,r.openmrsFetch)("/ws/rest/v1/patient/".concat(e,"/identifier/").concat(t,"?purge"),{method:"DELETE",headers:{"Content-Type":"application/json"},signal:n.signal})]}))}))).apply(this,arguments)}},3979:(e,t,n)=>{var i={"./am.json":[1625,788],"./en.json":[3574,574],"./es.json":[8319,319],"./fr.json":[2757,757],"./he.json":[5833,833],"./km.json":[7807,807]};function r(e){if(!n.o(i,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],r=t[0];return n.e(t[1]).then((()=>n(r)))}r.keys=()=>Object.keys(i),r.id=3979,e.exports=r}}]);