"use strict";(globalThis.webpackChunk_openmrs_esm_form_builder_app=globalThis.webpackChunk_openmrs_esm_form_builder_app||[]).push([[1475],{11475:(e,n,t)=>{t.r(n),t.d(n,{default:()=>R});var r=t(16072),a=t.n(r),o=t(53941),l=t(56055),i=t(25987),s=t(78586),u=t(56067),c=t(87710),d=t.n(c),f=t(74583),m=t.n(f),b=t(16765),g=t.n(b),p=t(68206),v=t.n(p),E=t(73930),h=t.n(E),y=t(4079),_=t.n(y),A=t(50665),S={};S.styleTagTransform=_(),S.setAttributes=v(),S.insert=g().bind(null,"head"),S.domAPI=m(),S.insertStyleElement=h(),d()(A.A,S);const T=A.A&&A.A.locals?A.A.locals:void 0;function C(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function k(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function w(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){k(e,n,t[n])}))}return e}function O(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,a,o=[],l=!0,i=!1;try{for(t=t.call(e);!(l=(r=t.next()).done)&&(o.push(r.value),!n||o.length!==n);l=!0);}catch(e){i=!0,a=e}finally{try{l||null==t.return||t.return()}finally{if(i)throw a}}return o}}(e,n)||F(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(e,n){if(e){if("string"==typeof e)return C(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(t):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?C(e,n):void 0}}const R=function(e){var n=e.closeModal,t=e.pageIndex,c=e.schema,d=e.onSchemaChange,f=e.mode,m=e.sectionIndex,b=(0,o.useTranslation)().t,g=O((0,r.useState)(null),2),p=g[0],v=g[1],E=O((0,r.useState)([]),2),h=E[0],y=E[1],_=O((0,r.useState)(null),2),A=_[0],S=_[1],k=O((0,r.useState)(null),2),R=k[0],V=k[1],L=O((0,r.useState)([]),2),I=L[0],x=L[1],j=(0,s.h)(),P=j.forms,N=j.error,B=j.isLoading,D=(0,u.S)(p),q=D.clobdata,M=D.isLoadingClobdata,Q=D.clobdataError,U=(0,r.useCallback)((function(e){var n=e.selectedItem;v(n),S(null),V(null),x([])}),[]);(0,r.useEffect)((function(){q&&y(q.pages)}),[q]);var H=(0,r.useCallback)((function(e){var n=e.selectedItem;S(n),V(null),x([])}),[]),Y=(0,r.useCallback)((function(e){V(e),x([])}),[]),W=(0,r.useCallback)((function(e,n){x((function(t){return n?t.filter((function(n){return n!==e.id})):t.some((function(n){return n===e.id}))?t:(r=t,function(e){if(Array.isArray(e))return C(e)}(r)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||F(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).concat([e.id]);var r}))}),[]);return(0,r.useEffect)((function(){if("edit"===f&&void 0!==m&&P){var e=c.pages[t].sections[m].reference,n=P.find((function(n){return n.name===e.form}));n&&v(n)}}),[f,m,P,c,t]),(0,r.useEffect)((function(){if("edit"===f&&p&&q&&void 0!==m){var e=c.pages[t].sections[m].reference,n=q.pages.find((function(n){return n.label===e.page}));if(n){S(n);var r=n.sections.find((function(n){return n.label===e.section}));r&&V(r),x(e.excludeQuestions)}}}),[f,p,q,c,t,m]),a().createElement(a().Fragment,null,a().createElement(l.rQ0,{closeModal:n,title:b("addFormComponent","Add Form Component")}),a().createElement(l.lVW,{className:T.form},a().createElement(l.cwr,{className:T.modalBody},a().createElement(l.BJc,{gap:4},B?a().createElement(l.OuH,{description:b("loading","Loading...")}):N?a().createElement(l.jeF,null,b("errorLoadingForms","Error loading forms")):0===P.length?a().createElement(l.jeF,null,b("noFormsAvailable","No forms available")):f?null:a().createElement(l.gE_,{legendText:"",display:"edit"===f?"hidden":"inline"},a().createElement(l.msM,{titleText:b("selectForm","Select form"),id:"form-component-dropdown",label:b("selectForm","Select form"),items:P.map((function(e){return{uuid:e.uuid,name:e.name,resources:e.resources}})),itemToString:function(e){return e?e.name:""},onChange:U})),M?a().createElement(l.OuH,{description:b("loading","Loading...")}):Q?a().createElement(l.jeF,null,b("errorLoadingForm","Error loading form")):h&&h.length>0&&!f?a().createElement(a().Fragment,null,a().createElement(l.gE_,{legendText:""},a().createElement(l.msM,{titleText:"".concat(p.name," ").concat(b("pages","Pages"),":"),id:"form-Pages-dropdown",label:b("Page","Select page"),items:h.map((function(e){return{label:e.label,sections:e.sections}})),itemToString:function(e){return e?e.label:""},onChange:H,selectedItem:A})),A?a().createElement(l.gE_,{legendText:""},a().createElement(l.zWQ,{orientation:"vertical",name:"radio-button-group",legendText:"".concat(A.label," ").concat(b("sections","Sections"),":")},A.sections.map((function(e){return a().createElement(l.aaP,{key:"".concat(A.label,"-").concat(e.label),labelText:e.label,id:"".concat(A.label,"-").concat(e.label),value:e.label,onClick:function(){return Y(e)}})})))):null):null,R?a().createElement(l.gE_,{legendText:""},a().createElement(l.$QX,{legendText:b("selectQuestions","Select questions")},R.questions.map((function(e){return a().createElement(l.Sc0,{key:e.id,labelText:e.label||e.id,id:"".concat(R.label,"-").concat(e.id),value:e.id,checked:!I.includes(e.id),onChange:function(n,t){var r=t.checked;return W(e,r)}})})))):null))),a().createElement(l.jlY,null,a().createElement(l.$nd,{kind:"secondary",onClick:n},b("cancel","Cancel")),a().createElement(l.$nd,{kind:"primary",onClick:function(){(function(){try{var e;if("edit"===f&&void 0!==m)return c.pages[t].sections[m].reference.excludeQuestions=I,d(w({},c)),void(0,i.showSnackbar)({title:b("success","Success!"),kind:"success",isLowContrast:!0,subtitle:b("questionsUpdated","Questions updated")});(null===(e=c.referencedForms)||void 0===e?void 0:e.some((function(e){return e.formName===p.name})))||(c.referencedForms?c.referencedForms.push({formName:p.name,alias:p.name}):c.referencedForms=[{formName:p.name,alias:p.name}]),c.pages[t].sections.push({label:R.label,isExpanded:"true",questions:[],reference:{form:p.name,page:A.label,section:R.label,excludeQuestions:I}}),d(w({},c)),(0,i.showSnackbar)({title:b("success","Success!"),kind:"success",isLowContrast:!0,subtitle:b("componentadded","Component added")})}catch(e){n=e,(null!=(r=Error)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r)&&(0,i.showSnackbar)({title:b("errorAddingComponent","Error adding component"),kind:"error",subtitle:null==e?void 0:e.message})}var n,r})(),n()},disabled:!p||!A||!R||I.length===R.questions.length},a().createElement("span",null,"edit"===f?b("update","Update"):b("add","Add")))))}},50665:(e,n,t)=>{t.d(n,{A:()=>i});var r=t(85037),a=t.n(r),o=t(15720),l=t.n(o)()(a());l.push([e.id,".-esm-form-builder__add-form-reference__modalBody___Iu7-Y{min-height:350px;overflow-y:hidden}.-esm-form-builder__add-form-reference__form___Ykjl0{overflow-y:scroll}","",{version:3,sources:["webpack://./src/components/interactive-builder/modals/add-form-reference/add-form-reference.scss"],names:[],mappings:"AAEA,0DACE,gBAAA,CACA,iBAAA,CAGF,qDACE,iBAAA",sourcesContent:["@use '@carbon/layout';\n\n.modalBody {\n  min-height: 350px;\n  overflow-y: hidden;\n}\n\n.form {\n  overflow-y: scroll;\n}\n"],sourceRoot:""}]),l.locals={modalBody:"-esm-form-builder__add-form-reference__modalBody___Iu7-Y",form:"-esm-form-builder__add-form-reference__form___Ykjl0"};const i=l},54225:(e,n,t)=>{t.d(n,{A:()=>u});var r=t(16072),a=t(19888),o=t(14993);const l=r.use||(e=>{if("pending"===e.status)throw e;if("fulfilled"===e.status)return e.value;throw"rejected"===e.status?e.reason:(e.status="pending",e.then((n=>{e.status="fulfilled",e.value=n}),(n=>{e.status="rejected",e.reason=n})),e)}),i={dedupe:!0};o.qv.defineProperty(o.BE,"defaultValue",{value:o.sb});const s=(0,o.qm)(((e,n,t)=>{const{cache:s,compare:u,suspense:c,fallbackData:d,revalidateOnMount:f,revalidateIfStale:m,refreshInterval:b,refreshWhenHidden:g,refreshWhenOffline:p,keepPreviousData:v}=t,[E,h,y,_]=o.bZ.get(s),[A,S]=(0,o.lK)(e),T=(0,r.useRef)(!1),C=(0,r.useRef)(!1),k=(0,r.useRef)(A),w=(0,r.useRef)(n),O=(0,r.useRef)(t),F=()=>O.current,R=()=>F().isVisible()&&F().isOnline(),[V,L,I,x]=(0,o.r9)(s,A),j=(0,r.useRef)({}).current,P=(0,o.b0)(d)?t.fallback[A]:d,N=(e,n)=>{for(const t in j){const r=t;if("data"===r){if(!u(e[r],n[r])){if(!(0,o.b0)(e[r]))return!1;if(!u(W,n[r]))return!1}}else if(n[r]!==e[r])return!1}return!0},B=(0,r.useMemo)((()=>{const e=!!A&&!!n&&((0,o.b0)(f)?!F().isPaused()&&!c&&(!!(0,o.b0)(m)||m):f),t=n=>{const t=(0,o.rL)(n);return delete t._k,e?{isValidating:!0,isLoading:!0,...t}:t},r=V(),a=x(),l=t(r),i=r===a?l:t(a);let s=l;return[()=>{const e=t(V());return N(e,s)?(s.data=e.data,s.isLoading=e.isLoading,s.isValidating=e.isValidating,s.error=e.error,s):(s=e,e)},()=>i]}),[s,A]),D=(0,a.useSyncExternalStore)((0,r.useCallback)((e=>I(A,((n,t)=>{N(t,n)||e()}))),[s,A]),B[0],B[1]),q=!T.current,M=E[A]&&E[A].length>0,Q=D.data,U=(0,o.b0)(Q)?P:Q,H=D.error,Y=(0,r.useRef)(U),W=v?(0,o.b0)(Q)?Y.current:Q:U,$=!(M&&!(0,o.b0)(H))&&(q&&!(0,o.b0)(f)?f:!F().isPaused()&&(c?!(0,o.b0)(U)&&m:(0,o.b0)(U)||m)),X=!!(A&&n&&q&&$),Z=(0,o.b0)(D.isValidating)?X:D.isValidating,J=(0,o.b0)(D.isLoading)?X:D.isLoading,z=(0,r.useCallback)((async e=>{const n=w.current;if(!A||!n||C.current||F().isPaused())return!1;let r,a,l=!0;const i=e||{},s=!y[A]||!i.dedupe,c=()=>o.dO?!C.current&&A===k.current&&T.current:A===k.current,d={isValidating:!1,isLoading:!1},f=()=>{L(d)},m=()=>{const e=y[A];e&&e[1]===a&&delete y[A]},b={isValidating:!0};(0,o.b0)(V().data)&&(b.isLoading=!0);try{if(s&&(L(b),t.loadingTimeout&&(0,o.b0)(V().data)&&setTimeout((()=>{l&&c()&&F().onLoadingSlow(A,t)}),t.loadingTimeout),y[A]=[n(S),(0,o.lg)()]),[r,a]=y[A],r=await r,s&&setTimeout(m,t.dedupingInterval),!y[A]||y[A][1]!==a)return s&&c()&&F().onDiscarded(A),!1;d.error=o.ZH;const e=h[A];if(!(0,o.b0)(e)&&(a<=e[0]||a<=e[1]||0===e[1]))return f(),s&&c()&&F().onDiscarded(A),!1;const i=V().data;d.data=u(i,r)?i:r,s&&c()&&F().onSuccess(r,A,t)}catch(e){m();const n=F(),{shouldRetryOnError:t}=n;n.isPaused()||(d.error=e,s&&c()&&(n.onError(e,A,n),(!0===t||(0,o.Tn)(t)&&t(e))&&(F().revalidateOnFocus&&F().revalidateOnReconnect&&!R()||n.onErrorRetry(e,A,n,(e=>{const n=E[A];n&&n[0]&&n[0](o.bu.ERROR_REVALIDATE_EVENT,e)}),{retryCount:(i.retryCount||0)+1,dedupe:!0}))))}return l=!1,f(),!0}),[A,s]),G=(0,r.useCallback)(((...e)=>(0,o.mF)(s,k.current,...e)),[]);if((0,o.Es)((()=>{w.current=n,O.current=t,(0,o.b0)(Q)||(Y.current=Q)})),(0,o.Es)((()=>{if(!A)return;const e=z.bind(o.ZH,i);let n=0;const t=(0,o.aw)(A,E,((t,r={})=>{if(t==o.bu.FOCUS_EVENT){const t=Date.now();F().revalidateOnFocus&&t>n&&R()&&(n=t+F().focusThrottleInterval,e())}else if(t==o.bu.RECONNECT_EVENT)F().revalidateOnReconnect&&R()&&e();else{if(t==o.bu.MUTATE_EVENT)return z();if(t==o.bu.ERROR_REVALIDATE_EVENT)return z(r)}}));return C.current=!1,k.current=A,T.current=!0,L({_k:S}),$&&((0,o.b0)(U)||o.X3?e():(0,o.mf)(e)),()=>{C.current=!0,t()}}),[A]),(0,o.Es)((()=>{let e;function n(){const n=(0,o.Tn)(b)?b(V().data):b;n&&-1!==e&&(e=setTimeout(t,n))}function t(){V().error||!g&&!F().isVisible()||!p&&!F().isOnline()?n():z(i).then(n)}return n(),()=>{e&&(clearTimeout(e),e=-1)}}),[b,g,p,A]),(0,r.useDebugValue)(W),c&&(0,o.b0)(U)&&A){if(!o.dO&&o.X3)throw new Error("Fallback data is required when using suspense in SSR.");w.current=n,O.current=t,C.current=!1;const e=_[A];if(!(0,o.b0)(e)){const n=G(e);l(n)}if(!(0,o.b0)(H))throw H;{const e=z(i);(0,o.b0)(W)||(e.status="fulfilled",e.value=!0),l(e)}}return{mutate:G,get data(){return j.data=!0,W},get error(){return j.error=!0,H},get isValidating(){return j.isValidating=!0,Z},get isLoading(){return j.isLoading=!0,J}}})),u=(0,o.Ht)(s,(e=>(n,t,r)=>(r.revalidateOnFocus=!1,r.revalidateIfStale=!1,r.revalidateOnReconnect=!1,e(n,t,r))))},56067:(e,n,t)=>{t.d(n,{S:()=>o});var r=t(54225),a=t(25987),o=function(e){var n,t,o,l=null==e||null===(t=e.resources)||void 0===t||null===(n=t.find((function(e){return"JSON schema"===e.name})))||void 0===n?void 0:n.valueReference,i=e&&(null==e||null===(o=e.resources)||void 0===o?void 0:o.length)>0&&l,s="".concat(a.restBaseUrl,"/clobdata/").concat(l),u=(0,r.A)(i?s:null,a.openmrsFetch),c=u.data,d=u.error,f=u.isLoading,m=u.isValidating,b=u.mutate;return{clobdata:null==c?void 0:c.data,clobdataError:d,isLoadingClobdata:f,isValidatingClobdata:m,mutate:b}}},78586:(e,n,t)=>{t.d(n,{h:()=>o});var r=t(59324),a=t(25987);function o(){var e,n,t="".concat(a.restBaseUrl,"/form?v=custom:(uuid,name,encounterType:(uuid,name),version,published,retired,resources:(uuid,name,dataType,valueReference))"),o=(0,r.Ay)(t,a.openmrsFetch),l=o.data,i=o.error,s=o.isValidating,u=o.mutate;return{forms:null!==(n=null==l||null===(e=l.data)||void 0===e?void 0:e.results)&&void 0!==n?n:[],error:i,isLoading:!l&&!i||!1,isValidating:s,mutate:u}}}}]);