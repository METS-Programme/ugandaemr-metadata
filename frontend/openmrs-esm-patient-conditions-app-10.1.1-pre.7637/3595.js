"use strict";(globalThis.webpackChunk_openmrs_esm_patient_conditions_app=globalThis.webpackChunk_openmrs_esm_patient_conditions_app||[]).push([[3595],{3595:(e,t,n)=>{n.r(t),n.d(t,{default:()=>S});var r=n(1343),i=n.n(r),a=n(3373),o=n.n(a),l=n(3150),u=n(824),s=n(1160),c=n(6195),d=n(5828),m=n(8254),f=n(4145),p=n(7087),b=n(6745);function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){l=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw i}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const S=function(e){var t,n,a,v=e.closeWorkspace,S=e.closeWorkspaceWithSavedChanges,h=e.condition,E=e.formContext,A=e.patientUuid,C=e.promptBeforeClosing,T=(0,l.useTranslation)().t,k="tablet"===(0,m.useLayoutType)(),w=(0,f.AS)(A).conditions,D=y((0,r.useState)(!1),2),N=D[0],_=D[1],j=y((0,r.useState)(null),2),O=j[0],W=j[1],z=y((0,r.useState)(null),2),F=z[0],I=z[1],U="editing"===E,q=null==w?void 0:w.find((function(e){return(null==e?void 0:e.id)===(null==h?void 0:h.id)})),$=function(e,t){var n="creating"===e,r=c.z.string().refine((function(e){return!n||!!e}),{message:t("clinicalStatusRequired","A clinical status is required")}),i=c.z.string().refine((function(e){return!n||!!e}),{message:t("conditionRequired","A condition is required")});return c.z.object({abatementDateTime:c.z.date().optional().nullable(),clinicalStatus:r,conditionName:i,onsetDateTime:c.z.date().nullable().refine((function(e){return e<=new Date}),{message:t("onsetDateCannotBeInTheFuture","Onset date cannot be in the future")})})}(E,T),x={abatementDateTime:U&&(null==q?void 0:q.abatementDateTime)?new Date(null==q?void 0:q.abatementDateTime):null,conditionName:"",clinicalStatus:U&&null!==(n=null==q||null===(t=q.clinicalStatus)||void 0===t?void 0:t.toLowerCase())&&void 0!==n?n:"",onsetDateTime:U&&(null==q?void 0:q.onsetDateTime)?new Date(null==q?void 0:q.onsetDateTime):null},B=(0,u.mN)({mode:"all",resolver:(0,s.u)($),defaultValues:x}),L=B.formState.isDirty;return(0,r.useEffect)((function(){C((function(){return L}))}),[L,C]),i().createElement(u.Op,B,i().createElement(d.lVW,{className:b.A.form,onSubmit:B.handleSubmit((function(){_(!0)}),(function(){return _(!1)}))},i().createElement(p.default,{closeWorkspaceWithSavedChanges:S,conditionToEdit:h,isEditing:U,isSubmittingForm:N,patientUuid:A,setErrorCreating:W,setErrorUpdating:I,setIsSubmittingForm:_}),i().createElement("div",null,O?i().createElement("div",{className:b.A.errorContainer},i().createElement(d.jeF,{className:b.A.error,role:"alert",kind:"error",lowContrast:!0,title:T("errorCreatingCondition","Error creating condition"),subtitle:null==O?void 0:O.message})):null,F?i().createElement("div",{className:b.A.errorContainer},i().createElement(d.jeF,{className:b.A.error,role:"alert",kind:"error",lowContrast:!0,title:T("errorUpdatingCondition","Error updating condition"),subtitle:null==F?void 0:F.message})):null,i().createElement(d.Te$,{className:o()((a={},g(a,b.A.tablet,k),g(a,b.A.desktop,!k),a))},i().createElement(d.$nd,{className:b.A.button,kind:"secondary",onClick:v},T("cancel","Cancel")),i().createElement(d.$nd,{className:b.A.button,disabled:N,kind:"primary",type:"submit"},N?i().createElement(d.OuH,{className:b.A.spinner,description:T("saving","Saving")+"..."}):i().createElement("span",null,T("saveAndClose","Save & close")))))))}}}]);