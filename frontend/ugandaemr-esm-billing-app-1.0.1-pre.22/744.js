"use strict";(globalThis.webpackChunk_ugandaemr_esm_billing_app=globalThis.webpackChunk_ugandaemr_esm_billing_app||[]).push([[744],{8014:(e,n,t)=>{t.d(n,{A:()=>o});var r=t(5037),a=t.n(r),i=t(5720),l=t.n(i)()(a());l.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79;--bottom-nav-height: 4rem;--workspace-header-height: 3rem;--tablet-workspace-window-height: calc(100vh - var(--omrs-navbar-height) - var(--bottom-nav-height));--desktop-workspace-window-height: calc(100vh - var(--omrs-navbar-height) - var(--workspace-header-height))}.-esm-billing__billing-form__tablet___depIv{padding:1.5rem 1rem;background-color:#fff}.-esm-billing__billing-form__desktop___XrIGU{padding:0rem}.-esm-billing__billing-form__button___\\+KaHL{height:4rem;display:flex;align-content:flex-start;align-items:baseline;min-width:50%}.-esm-billing__billing-form__button___\\+KaHL .cds--inline-loading{min-height:1rem !important}.-esm-billing__billing-form__button___\\+KaHL .cds--inline-loading__text{font-size:unset !important}.-esm-billing__billing-form__mt2___XSCej{margin-top:2rem}.-esm-billing__billing-form__searchContent___rwtx-{position:absolute;background-color:#fff;min-width:230px;overflow:auto;border:1px solid #ddd;z-index:1;width:92%}.-esm-billing__billing-form__searchItem___gJRX7{border-bottom:.1rem solid;border-bottom-color:silver;cursor:pointer}.-esm-billing__billing-form__invalidInput___-CFhJ{border:2px solid red}.-esm-billing__billing-form__invalidInput___-CFhJ .cds--text-input:focus{outline-color:rgba(0,0,0,0)}.-esm-billing__billing-form__removeButton___JOb\\+t{color:#ee0909;right:20px;cursor:pointer}.-esm-billing__billing-form__form___dOD1L{display:flex;flex-direction:column;justify-content:space-between;height:calc(100vh - 6rem)}.omrs-breakpoint-lt-desktop .-esm-billing__billing-form__form___dOD1L{background-color:#ededed}.omrs-breakpoint-gt-tablet .-esm-billing__billing-form__form___dOD1L{background-color:#fff}.-esm-billing__billing-form__grid___bVIsN{margin:1rem}.-esm-billing__billing-form__row___kfkPE{margin:.5rem 0rem 0rem;display:flex;flex-flow:row wrap;gap:1rem}.-esm-billing__billing-form__spacer___5WyoB{margin-top:1rem}","",{version:3,sources:["webpack://./node_modules/@openmrs/esm-styleguide/src/_vars.scss","webpack://./src/billing-form/billing-form.scss","webpack://./node_modules/@carbon/layout/scss/generated/_spacing.scss"],names:[],mappings:"AAoDA,MACE,mBAAA,CACA,mBAAA,CACA,mBAAA,CACA,yBAAA,CACA,+BAAA,CACA,oGAAA,CACA,2GAAA,CCxDF,4CACE,mBAAA,CACA,qBDJM,CCOR,6CACE,YAAA,CAGF,6CACE,WC2CW,CD1CX,YAAA,CACA,wBAAA,CACA,oBAAA,CACA,aAAA,CAEA,kEACE,0BAAA,CAGF,wEACE,0BAAA,CAIJ,yCACE,eCYW,CDTb,mDACE,iBAAA,CACA,qBAAA,CACA,eAAA,CACA,aAAA,CACA,qBAAA,CACA,SAAA,CACA,SAAA,CAGF,gDACE,yBAAA,CACA,0BAAA,CACA,cAAA,CAGF,kDACE,oBAAA,CAEA,yEACE,2BAAA,CAIJ,mDACE,aAAA,CACA,UAAA,CACA,cAAA,CAGF,0CACE,YAAA,CACA,qBAAA,CACA,6BAAA,CACA,yBAAA,CAGF,sEACE,wBAAA,CAGF,qEACE,qBDzEM,CC4ER,0CACE,WC/CW,CDkDb,yCACE,sBAAA,CACA,YAAA,CACA,kBAAA,CACA,QCtDW,CDyDb,4CACE,eC1DW",sourcesContent:["$ui-01: #f4f4f4;\n$ui-02: #ffffff;\n$ui-03: #e0e0e0;\n$ui-04: #8d8d8d;\n$ui-05: #161616;\n$text-02: #525252;\n$text-03: #a8a8a8;\n$ui-background: #ffffff;\n$color-gray-30: #c6c6c6;\n$color-gray-70: #525252;\n$color-gray-100: #161616;\n$color-blue-60-2: #0f62fe;\n$color-blue-10: #edf5ff;\n$color-yellow-50: #feecae;\n$carbon--red-50: #fa4d56;\n$inverse-link: #78a9ff;\n$support-02: #24a148;\n$inverse-support-03: #f1c21b;\n$warning-background: #fff8e1;\n$openmrs-background-grey: #f4f4f4;\n$danger: #da1e28;\n$interactive-01: #0f62fe;\n$field-01: #f4f4f4;\n$grey-2: #e0e0e0;\n$labeldropdown: #c6c6c6;\n\n$brand-primary-10: #d9fbfb;\n$brand-primary-20: #9ef0f0;\n$brand-primary-30: #3ddbd9;\n$brand-primary-40: #08bdba;\n$brand-primary-50: #009d9a;\n\n/* 60,70 and 80 are already declared as brand-01, 02 and 03 respectively */\n\n$brand-primary-90: #022b30;\n$brand-primary-100: #081a1c;\n\n@mixin brand-01($property) {\n  #{$property}: #005d5d;\n  #{$property}: var(--brand-01);\n}\n\n@mixin brand-02($property) {\n  #{$property}: #004144;\n  #{$property}: var(--brand-02);\n}\n\n@mixin brand-03($property) {\n  #{$property}: #007d79;\n  #{$property}: var(--brand-03);\n}\n\n:root {\n  --brand-01: #005d5d;\n  --brand-02: #004144;\n  --brand-03: #007d79;\n  --bottom-nav-height: 4rem;\n  --workspace-header-height: 3rem;\n  --tablet-workspace-window-height: calc(100vh - var(--omrs-navbar-height) - var(--bottom-nav-height));\n  --desktop-workspace-window-height: calc(100vh - var(--omrs-navbar-height) - var(--workspace-header-height));\n}\n\n$breakpoint-phone-min: 0px;\n$breakpoint-phone-max: 600px;\n$breakpoint-tablet-min: 601px;\n$breakpoint-tablet-max: 1023px;\n$breakpoint-small-desktop-min: 1024px;\n$breakpoint-small-desktop-max: 1439px;\n$breakpoint-large-desktop-min: 1440px;\n$breakpoint-large-desktop-max: 99999999px;\n\n/* These color variables will be removed in a future release */\n$brand-teal-01: #007d79;\n$brand-01: #005d5d;\n$brand-02: #004144;\n","@use '@carbon/layout';\n@use '@openmrs/esm-styleguide/src/vars' as *;\n\n.tablet {\n  padding: layout.$spacing-06 layout.$spacing-05;\n  background-color: $ui-02;\n}\n\n.desktop {\n  padding: 0rem;\n}\n\n.button {\n  height: layout.$spacing-10;\n  display: flex;\n  align-content: flex-start;\n  align-items: baseline;\n  min-width: 50%;\n\n  :global(.cds--inline-loading) {\n    min-height: layout.$spacing-05 !important;\n  }\n\n  :global(.cds--inline-loading__text) {\n    font-size: unset !important;\n  }\n}\n\n.mt2 {\n  margin-top: layout.$spacing-07;\n}\n\n.searchContent {\n  position: absolute;\n  background-color: #fff;\n  min-width: 230px;\n  overflow: auto;\n  border: 1px solid #ddd;\n  z-index: 1;\n  width: 92%;\n}\n\n.searchItem {\n  border-bottom: 0.1rem solid;\n  border-bottom-color: silver;\n  cursor: pointer;\n}\n\n.invalidInput {\n  border: 2px solid red;\n\n  :global(.cds--text-input:focus) {\n    outline-color: transparent;\n  }\n}\n\n.removeButton {\n  color: #ee0909;\n  right: 20px;\n  cursor: pointer;\n}\n\n.form {\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  height: calc(100vh - 6rem);\n}\n\n:global(.omrs-breakpoint-lt-desktop) .form {\n  background-color: #ededed;\n}\n\n:global(.omrs-breakpoint-gt-tablet) .form {\n  background-color: $ui-02;\n}\n\n.grid {\n  margin: layout.$spacing-05;\n}\n\n.row {\n  margin: layout.$spacing-03 0rem 0rem;\n  display: flex;\n  flex-flow: row wrap;\n  gap: layout.$spacing-05;\n}\n\n.spacer {\n  margin-top: layout.$spacing-05;\n}\n","// Code generated by @carbon/layout. DO NOT EDIT.\n//\n// Copyright IBM Corp. 2018, 2023\n//\n// This source code is licensed under the Apache-2.0 license found in the\n// LICENSE file in the root directory of this source tree.\n//\n\n/// @type Number\n/// @access public\n/// @group @carbon/layout\n$spacing-01: 0.125rem !default;\n\n/// @type Number\n/// @access public\n/// @group @carbon/layout\n$spacing-02: 0.25rem !default;\n\n/// @type Number\n/// @access public\n/// @group @carbon/layout\n$spacing-03: 0.5rem !default;\n\n/// @type Number\n/// @access public\n/// @group @carbon/layout\n$spacing-04: 0.75rem !default;\n\n/// @type Number\n/// @access public\n/// @group @carbon/layout\n$spacing-05: 1rem !default;\n\n/// @type Number\n/// @access public\n/// @group @carbon/layout\n$spacing-06: 1.5rem !default;\n\n/// @type Number\n/// @access public\n/// @group @carbon/layout\n$spacing-07: 2rem !default;\n\n/// @type Number\n/// @access public\n/// @group @carbon/layout\n$spacing-08: 2.5rem !default;\n\n/// @type Number\n/// @access public\n/// @group @carbon/layout\n$spacing-09: 3rem !default;\n\n/// @type Number\n/// @access public\n/// @group @carbon/layout\n$spacing-10: 4rem !default;\n\n/// @type Number\n/// @access public\n/// @group @carbon/layout\n$spacing-11: 5rem !default;\n\n/// @type Number\n/// @access public\n/// @group @carbon/layout\n$spacing-12: 6rem !default;\n\n/// @type Number\n/// @access public\n/// @group @carbon/layout\n$spacing-13: 10rem !default;\n\n/// @type Map\n/// @access public\n/// @group @carbon/layout\n$spacing: (\n  spacing-01: $spacing-01,\n  spacing-02: $spacing-02,\n  spacing-03: $spacing-03,\n  spacing-04: $spacing-04,\n  spacing-05: $spacing-05,\n  spacing-06: $spacing-06,\n  spacing-07: $spacing-07,\n  spacing-08: $spacing-08,\n  spacing-09: $spacing-09,\n  spacing-10: $spacing-10,\n  spacing-11: $spacing-11,\n  spacing-12: $spacing-12,\n  spacing-13: $spacing-13,\n);\n"],sourceRoot:""}]),l.locals={tablet:"-esm-billing__billing-form__tablet___depIv",desktop:"-esm-billing__billing-form__desktop___XrIGU",button:"-esm-billing__billing-form__button___+KaHL",mt2:"-esm-billing__billing-form__mt2___XSCej",searchContent:"-esm-billing__billing-form__searchContent___rwtx-",searchItem:"-esm-billing__billing-form__searchItem___gJRX7",invalidInput:"-esm-billing__billing-form__invalidInput___-CFhJ",removeButton:"-esm-billing__billing-form__removeButton___JOb+t",form:"-esm-billing__billing-form__form___dOD1L",grid:"-esm-billing__billing-form__grid___bVIsN",row:"-esm-billing__billing-form__row___kfkPE",spacer:"-esm-billing__billing-form__spacer___5WyoB"};const o=l},4744:(e,n,t)=>{t.r(n),t.d(n,{default:()=>Q});var r=t(6072),a=t.n(r),i=t(6401),l=t(6516),o=t(3270),c=t(7626),s=t(3941),u=t(4476),m=t(5972),d=t(4200),p=t(9530),b=t(5806),g=t(7710),A=t.n(g),f=t(4583),_=t.n(f),y=t(6765),v=t.n(y),h=t(8206),C=t.n(h),$=t(3930),k=t.n($),E=t(4079),w=t.n(E),I=t(8014),x={};x.styleTagTransform=w(),x.setAttributes=C(),x.insert=v().bind(null,"head"),x.domAPI=_(),x.insertStyleElement=k(),A()(I.A,x);const S=I.A&&I.A.locals?I.A.locals:void 0;function N(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function B(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function P(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){B(e,n,t[n])}))}return e}function O(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t.push.apply(t,r)}return t}(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})),e}function T(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,a,i=[],l=!0,o=!1;try{for(t=t.call(e);!(l=(r=t.next()).done)&&(i.push(r.value),!n||i.length!==n);l=!0);}catch(e){o=!0,a=e}finally{try{l||null==t.return||t.return()}finally{if(o)throw a}}return i}}(e,n)||j(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e){return function(e){if(Array.isArray(e))return N(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||j(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e,n){if(e){if("string"==typeof e)return N(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(t):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?N(e,n):void 0}}const Q=function(e){var n=e.patientUuid,t=e.closeWorkspace,g=(0,s.useTranslation)().t,A=(0,m.useConfig)(),f=A.defaultCurrency,_=A.postBilledItems,y="tablet"===(0,m.useLayoutType)(),v=T((0,r.useState)(0),2),h=v[0],C=v[1],$=T((0,r.useState)([]),2),k=$[0],E=$[1],w=T((0,r.useState)([]),2),I=w[0],x=w[1],N=T((0,r.useState)(""),2),B=N[0],j=N[1],Q=T((0,r.useState)(!1),2),F=Q[0],G=Q[1],L=T((0,r.useState)(!1),2),W=L[0],J=L[1],z=T((0,r.useState)([]),2),H=z[0],X=z[1],q=T((0,r.useState)(""),2),U=q[0],K=q[1],M=(0,m.useDebounce)(U),R=T((0,r.useState)(!0),2),Y=R[0],V=R[1],Z=(0,r.useRef)(null),ee=u.z.object({Qnty:u.z.number().min(1,g("quantityGreaterThanZero","Quantity must be at least one for all items."))}),ne=(0,b.u5)(M,B),te=ne.data,re=(ne.error,ne.isLoading);return ne.isValidating,(0,r.useEffect)((function(){var e;E((null==te||null===(e=te.results)||void 0===e?void 0:e.map((function(e){var n,t;return"Stock Item"===B?{uuid:(null==e?void 0:e.uuid)||"",Item:(null==e?void 0:e.drugName)?null==e?void 0:e.drugName:null==e?void 0:e.commonName,Qnty:1,Price:(null==e?void 0:e.drugName)?null==e?void 0:e.purchasePrice:0,Total:(null==e?void 0:e.drugName)?null==e?void 0:e.purchasePrice:0,category:"StockItem"}:{uuid:(null==e?void 0:e.uuid)||"",Item:(null==e?void 0:e.name)?null==e?void 0:e.name:"",Qnty:1,Price:(null==e?void 0:e.servicePrices.length)>0?null==e||null===(n=e.servicePrices[0])||void 0===n?void 0:n.price:0,Total:(null==e?void 0:e.servicePrices.length)>0?null==e||null===(t=e.servicePrices[0])||void 0===t?void 0:t.price:0,category:"Service"}})))||[])}),[te,B]),(0,r.useEffect)((function(){var e=function(e){Z.current&&!Z.current.contains(e.target)&&(document.getElementById("searchField").value="",K(""),E([]))};return document.addEventListener("mousedown",e),function(){return document.removeEventListener("mousedown",e)}}),[]),a().createElement(l.lVW,{className:S.form},a().createElement("div",{className:S.grid},a().createElement(l.BJc,null,a().createElement(l.zWQ,{legendText:g("selectCategory","Select category"),name:"radio-button-group",defaultSelected:"radio-1",className:S.mt2,onChange:function(e){(0,i.A)(e)||V(!1),j("Stock Item"===e?"Stock Item":"Service")}},a().createElement(l.aaP,{labelText:g("stockItem","Stock Item"),value:"Stock Item",id:"stockItem"}),a().createElement(l.aaP,{labelText:g("service","Service"),value:"Service",id:"service"}))),a().createElement(l.BJc,null,a().createElement(l.vji,{id:"searchField",size:"lg",className:S.mt2,disabled:Y,onKeyUp:function(e){return K(e.target.value)},placeholder:g("searchItems","Search items and services"),labelText:g("searchItems","Search items and services")})),a().createElement(l.BJc,null,a().createElement("ul",{className:S.searchContent,ref:Z},(null==k?void 0:k.length)>0&&(null==k?void 0:k.map((function(e){return a().createElement("li",{key:e.uuid,className:S.searchItem},a().createElement(l.$nd,{id:e.uuid,onClick:function(n){return function(e,n,t,r,a){var i=I.findIndex((function(e){return e.uuid===n})),l=[];if(i>=0)l=I.map((function(e,n){if(n===i){var t=e.Qnty+1;return O(P({},e),{Qnty:t,Total:t*e.Price})}return e}));else{var o={uuid:n,Item:t,Qnty:1,Price:a,Total:a,category:r};l=D(I).concat([o]),X(D(H).concat([o]))}x(l),C(l.reduce((function(e,n){return e+n.Total}),0)),document.getElementById("searchField").value="",K(""),E([])}(0,e.uuid,e.Item,e.category,e.Price)},style:{background:"inherit",color:"black","max-width":"100%"}},e.Item," Qnty.",e.Qnty," ",f,".",e.Price))}))),0===(null==k?void 0:k.length)&&!re&&!!M&&a().createElement("p",null,g("noResultsFound","No results found")))),a().createElement(l.BJc,null,a().createElement(l.XIK,{"aria-label":"sample table",className:S.mt2},a().createElement(l.ndF,null,a().createElement(l.Hjg,null,a().createElement(l.A0N,null,"Item"),a().createElement(l.A0N,null,"Quantity"),a().createElement(l.A0N,null,"Price"),a().createElement(l.A0N,null,"Total"),a().createElement(l.A0N,null,"Action"))),a().createElement(l.BFY,null,I&&Array.isArray(I)?I.map((function(e){var n;return a().createElement(l.Hjg,{key:e.uuid},a().createElement(l.nA6,null,e.Item),a().createElement(l.nA6,null,a().createElement(l.ksK,{className:"".concat(e.Qnty<=0?S.invalidInput:""),defaultWidth:10,id:e.Item,value:e.Qnty||"",onChange:function(n){!function(e,n){var t=!0;try{ee.parse({Qnty:e})}catch(e){t=!1}var r=I.map((function(t){return t.Item===n?O(P({},t),{Qnty:e,Total:e*t.Price}):t}));x(r),G(!t||r.some((function(e){return e.Qnty<=0}))),C(r.reduce((function(e,n){return e+n.Total}),0))}(""===n.target.value?"":parseInt(n.target.value,10),e.Item)},size:"sm",type:"number"})),a().createElement(l.nA6,{id:e.Item+"Price"},e.Price),a().createElement(l.nA6,{id:e.Item+"Total",className:"totalValue"},null==e||null===(n=e.Total)||void 0===n?void 0:n.toLocaleString()),a().createElement(l.nA6,null,a().createElement(o.zH,{onClick:function(){return function(e){var n=I.filter((function(n){return n.uuid!==e}));x(n),X(H.filter((function(n){return n.uuid!==e})));var t=n.reduce((function(e,n){return e+n.Total}),0);C(t)}(e.uuid)},className:S.removeButton})))})):a().createElement("p",null,"Loading..."),a().createElement(l.Hjg,null,a().createElement(l.nA6,{colSpan:3}),a().createElement(l.nA6,{style:{fontWeight:"bold"}},g("grandTotal","Grand total"),":"),a().createElement(l.nA6,{id:"GrandTotalSum"},(0,p.aL)(h,f)))))),a().createElement(l.Te$,{className:y?S.tablet:S.desktop},a().createElement(l.$nd,{className:S.button,kind:"secondary",disabled:W,onClick:t},g("discard","Discard")),a().createElement(l.$nd,{className:S.button,kind:"primary",onClick:function(){J(!0);var e={cashPoint:_.cashPoint,cashier:_.cashier,lineItems:[],payments:[],patient:n,status:"PENDING"};I.forEach((function(n){var t={quantity:parseInt(n.Qnty),price:n.Price,priceName:"Default",priceUuid:_.priceUuid,lineItemOrder:0,paymentStatus:"PENDING"};"StockItem"===n.category?t.item=n.uuid:t.billableService=n.uuid,null==e||e.lineItems.push(t)}));var r="".concat(d.By,"bill");(0,b.Xn)(e).then((function(){J(!1),t(),(0,c.Tk)((function(e){return"string"==typeof e&&e.startsWith(r)}),void 0,{revalidate:!0}),(0,m.showSnackbar)({title:g("billItems","Save Bill"),subtitle:"Bill processing has been successful",kind:"success",timeoutInMs:3e3})}),(function(e){J(!1),(0,m.showSnackbar)({title:"Bill processing error",kind:"error",subtitle:null==e?void 0:e.message})}))},disabled:W||F,type:"submit"},W?a().createElement(l.OuH,{description:g("saving","Saving")+"..."}):g("saveAndClose","Save and close")))))}}}]);